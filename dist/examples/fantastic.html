<html>

<head>
    <meta charset="utf-8">
    <title>Fantastic charts</title>

    <script src="https://d3js.org/d3.v5.min.js" charset="utf-8"></script>
    <script src="../b3js.js"></script>
    <script src="prism.js"></script>

    <link href="prism.css" rel="stylesheet">

    <style>
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        .banner {
            min-height: 512px;
        }



    </style>

</head>

<body>

<h1>
    Displaying a basic chart
</h1>

<div class="grid">
    <div class="banner">
        <div id="graph" style="width: 900px; height: 420px;">
        </div>
    </div>

    <div>
        <h3>Date Histogram and line overlay</h3>
        <p>
            And here we have a simple overlay of a histogram and
            a line chart.
        </p>
        <pre><code class="language-js">let data = [
    { published: "2018-03-02T00:37:40.133Z", mentionCount: 10 },
    { published: "2018-03-03T00:37:40.133Z", mentionCount: 5},
    { published: "2018-03-04T00:37:40.133Z", mentionCount: 7},
    { published: "2018-03-05T00:37:40.133Z", mentionCount: 11}
];

graph
    .data(data)
    .element(document.getElementById('graph'))
    .x(d => d.published)
    .y(d => d.mentionCount)
    .geometry(b3js.histogram())
    .geometry(b3js.line())
    .scaleX(b3js.scaleTime())
    .yAxisLabel("Mention volume")
    .render();</code></pre>

    </div>


    <!-------------------------------------------->

    <div class="banner">
        <div id="bar-graph" style="width: 900px; height: 420px;">
        </div>
    </div>

    <div>
        <h3>Bar graph of counts</h3>
        <p>
            A bar graph of counts. Similar to the above, but rotated.
        </p>
        <pre><code class="language-js">data = [
    { published: "2018-03-02T00:37:40.133Z", mentionCount: 10, brand: "one"},
    { published: "2018-03-03T00:37:40.133Z", mentionCount: 5, brand: "one"},
    { published: "2018-03-04T00:37:40.133Z", mentionCount: 7, brand: "one"},
    { published: "2018-03-05T00:37:40.133Z", mentionCount: 11, brand: "one"},
    { published: "2018-03-02T00:37:40.133Z", mentionCount: 12, brand: "two"},
    { published: "2018-03-03T00:37:40.133Z", mentionCount: 8, brand: "two"},
    { published: "2018-03-04T00:37:40.133Z", mentionCount: 1, brand: "two"}
];


graph = new b3js.chart();

graph
    .data(data)
    .element(document.getElementById('bar-graph'))
    .x(d => d.mentionCount)
    .y(d => d.published)
    .colour(d => d.brand )
    .geometry(b3js.barChart())
    .scaleY(b3js.scaleTime())
    .yAxisLabel("Brand")
    .xAxisLabel("Mention count")
    .render();</code></pre>

    </div>


    <!-------------------------------------------->


    <div class="banner">
        <div id="graph-negative" style="width: 900px; height: 420px;">
        </div>
    </div>

    <div>
        <h3>Date histogram with positive and negative values</h3>
        <p>
            For instance, when showing net sentiment
        </p>
        <pre><code class="language-js">let data = [
    { published: "2018-03-02T00:37:40.133Z", totalSentiment: 101 },
    { published: "2018-03-03T00:37:40.133Z", totalSentiment: 51},
    { published: "2018-03-04T00:37:40.133Z", totalSentiment: -74},
    { published: "2018-03-05T00:37:40.133Z", totalSentiment: -110},
    { published: "2018-03-06T00:37:40.133Z", totalSentiment: 10}
];

graph
    .data(data)
    .element(document.getElementById('graph'))
    .x(d => d.published)
    .y(d => d.totalSentiment)
    .geometry(b3js.histogram())
    .scaleX(b3js.scaleTime())
    .yAxisLabel("Net Sentiment")
    .render();</code></pre>

    </div>


    <!-------------------------------------------->


    <div class="banner">
        <div id="histogram-comparison" style="width: 900px; height: 512px;">
        </div>
    </div>

    <div>
        <h3>Date Histogram comparison</h3>
        <p>
            And here we have a simple overlay of a histogram and
            a line chart.
        </p>
        <pre><code class="language-js">data = [
    { published: "2018-03-02T00:37:40.133Z", mentionCount: 10, brand: "one" },
    { published: "2018-03-03T00:37:40.133Z", mentionCount: 5, brand: "one"},
    { published: "2018-03-04T00:37:40.133Z", mentionCount: 7, brand: "one"},
    { published: "2018-03-05T00:37:40.133Z", mentionCount: 11, brand: "one"},
    { published: "2018-03-02T00:37:40.133Z", mentionCount: 2, brand: "two"},
    { published: "2018-03-03T00:37:40.133Z", mentionCount: 4, brand: "two"},
    { published: "2018-03-04T00:37:40.133Z", mentionCount: 6, brand: "two"},
    { published: "2018-03-05T00:37:40.133Z", mentionCount: 8, brand: "two"}
];

graph
    .data(data)
    .element(document.getElementById('histogram-comparison'))
    .x(d => d.published)
    .y(d => d.mentionCount)
    .colour( d => d.brand )
    .geometry(b3js.histogram())
    .scaleX(b3js.scaleTime())
    .render();</code></pre>

    </div>

    <!-------------------------------------------->

    <div class="banner">
        <div id="histogram-comparison-missing" style="width: 900px; height: 512px;">
        </div>
    </div>

    <div>
        <h3>Date Histogram comparison with missing data</h3>
        <p>
            Here, the dates have groups that are missing, and we
            would like them to be filled in automatically.
        </p>
        <pre><code class="language-js">
</code></pre>

    </div>

    <!-------------------------------------------->


    <div class="banner">
        <div id="histogram-brand-name" style="width: 900px; height: 512px;">
        </div>
    </div>

    <div>
        <h3>A bar chart of volume by brand name</h3>
        <p>
            We can show discrete, non-date values on the x-axis.
            Notice that it intelligently groups repeated x-axis groups.
        </p>
        <pre><code class="language-js">data = [
    { mentionCount: 10, brand: "Brand One" },
    { mentionCount: 2, brand: "Brand Two" },
    { mentionCount: 4, brand: "Brand Three"},
    { mentionCount: 8, brand: "Brand Four"},
    { mentionCount: 5, brand: "Brand Five"},
    { mentionCount: 5, brand: "Brand Five"}

];

graph
    .data(data)
    .element(document.getElementById('histogram-brand-name'))
    .x(d => d.brand)
    .y(d => d.mentionCount)
    .geometry(b3js.columnChart())
    .scaleX(b3js.scaleDiscrete())
    .yAxisLabel("Brand Volume")
    .render();
</code></pre>

    </div>

    <!-------------------------------------------->

    <div class="banner">
        <div id="histogram-facet" style="width: 900px; height: 420px;">
        </div>
    </div>

    <div>
        <h3>Histogram small multiple</h3>
        <p>
            And here we have a simple overlay of a histogram and
            a line chart.
        </p>

        <pre><code class="language-js">data = [
    { published: "2018-03-02T00:37:40.133Z", mentionCount: 10, brand: 1 },
    { published: "2018-03-03T00:37:40.133Z", mentionCount: 5, brand: 1},
    { published: "2018-03-04T00:37:40.133Z", mentionCount: 7, brand: 1},
    { published: "2018-03-05T00:37:40.133Z", mentionCount: 11, brand: 1},
    { published: "2018-03-02T00:37:40.133Z", mentionCount: 2, brand: 2 },
    { published: "2018-03-03T00:37:40.133Z", mentionCount: 4, brand: 2},
    { published: "2018-03-04T00:37:40.133Z", mentionCount: 6, brand: 2},
    { published: "2018-03-05T00:37:40.133Z", mentionCount: 8, brand: 2}
];

graph
    .data(data)
    .element(document.getElementById('histogram-facet'))
    .x(d => d.published)
    .y(d => d.mentionCount)
    .geometry(b3js.histogram())
    .scaleX(b3js.scaleTime())
    .facetX(d => d.brand)
    .render();</code></pre>

    </div>

    <!-------------------------------------------->

    <div class="banner">
        <div id="multiple-lines" style="width: 900px; height: 420px;">
        </div>
    </div>

    <div>
        <h3>Multiple lines by colour</h3>
        <p>
            Multiple lines separated by colour.
        </p>

        <pre><code class="language-js">data = [
    { published: "2018-03-02T00:37:40.133Z", mentionCount: 10, brand: 1 },
    { published: "2018-03-03T00:37:40.133Z", mentionCount: 5, brand: 1},
    { published: "2018-03-04T00:37:40.133Z", mentionCount: 7, brand: 1},
    { published: "2018-03-05T00:37:40.133Z", mentionCount: 11, brand: 1},
    { published: "2018-03-02T00:37:40.133Z", mentionCount: 2, brand: 2 },
    { published: "2018-03-03T00:37:40.133Z", mentionCount: 4, brand: 2},
    { published: "2018-03-04T00:37:40.133Z", mentionCount: 6, brand: 2},
    { published: "2018-03-05T00:37:40.133Z", mentionCount: 8, brand: 2}
];

</code></pre>

    </div>

    <!-------------------------------------------->

    <div class="banner">
        <div id="histogram-real" style="width: 900px; height: 420px;">
        </div>
    </div>

    <div>
        <h3>Histogram of real values</h3>
        <p>
            Showing engagement and volume.
        </p>
        <pre><code class="language-js">data = [
    {"published":"2018-07-14T22:00:00Z","aggregate":"mentionCount","count":1763},
    {"published":"2018-07-15T22:00:00Z","aggregate":"mentionCount","count":1332},
    // ...
    {"published":"2018-07-14T22:00:00Z","aggregate":"totalEngagement","count":638},
    {"published":"2018-07-15T22:00:00Z","aggregate":"totalEngagement","count":345},
    {"published":"2018-07-16T22:00:00Z","aggregate":"totalEngagement","count":2262}
];

graph
    .data(data)
    .element(document.getElementById('histogram-real'))
    .x(d => d.count)
    .geometry(b3js.histogram())
    .facetX(d => d.aggregate)
    .render();</code></pre>

    </div>

    <!-------------------------------------------->

    <div class="banner">
        <div id="sentiment-engagement-points" style="width: 900px; height: 420px;">
        </div>
    </div>

    <div>
        <h3>Net sentiment vs Engagement</h3>
        <p>
            Having powerful sentiment does not seem to correlate
            with high engagement.
        </p>

    </div>


    <!-------------------------------------------->

    <div class="banner">
        <div id="pie-chart">
        </div>
    </div>

    <div>
        <h3>Pie chart</h3>
        <p>

        </p>
        <pre><code class="language-js">const pieData = [
    { count: 1930, topicName: 'Reputation' },
    { count: 1030, topicName: 'Charity or outreach programmes' },
    { count: 130,  topicName: 'Banking products' },
    { count: 1234, topicName: 'Customer service' },
    { count: 441,  topicName: 'Bank facilities' },
    { count: 22,   topicName: 'Turnaround time' },
    { count: 568,  topicName: 'Comparing brands to brands' },
    { count: 244,  topicName: 'Outstanding debt or settlements' },
    { count: 902,  topicName: 'Speed or responsiveness of platform' },
    { count: 178,  topicName: 'Personal loans' },
    { count: 351,  topicName: 'Referral or dissuasion from one consumer to another' },
    { count: 800,  topicName: 'Staff or HR' },
    { count: 288,  topicName: 'No response received' },
    { count: 276,  topicName: 'Reaction to brands advertising' },
    { count: 1012, topicName: 'Business banking' },
    { count: 90,   topicName: 'Insurance' },
    { count: 582,  topicName: 'Multiple contacts' }
]

const pieChart = new b3js.chart('Pie');
const pieGeom = b3js.pie();

pieChart
    .data(pieData)
    .element(document.getElementById('pie-chart'))
    .x(d => d.topicName)
    .y(d => d.count)
    .geometry(pieGeom.isDonut(true))
    .scaleX(b3js.scaleDiscrete())
    .yAxisLabel('Count')
    .xAxisLabel('Topics')
    .showXAxis(false)
    .showYAxis(false)
    .render()</code></pre>
    </div>
</div>





<script>
    window.addEventListener("load", function() {
        let data = [
            { published: "2018-03-02T00:37:40.133Z", mentionCount: 10 },
            { published: "2018-03-03T00:37:40.133Z", mentionCount: 5},
            { published: "2018-03-04T00:37:40.133Z", mentionCount: 7},
            { published: "2018-03-05T00:37:40.133Z", mentionCount: 11}
        ];

        let graph = new b3js.chart();

        graph
            .data(data)
            .element(document.getElementById('graph'))
            .x(d => d.published)
            .y(d => d.mentionCount)
            .geometry(b3js.histogram())
            .geometry(b3js.line())
            .scaleX(b3js.scaleTime())
            .yAxisLabel("Mention volume")
            .render();



        data = [
            { published: "2018-03-02T00:37:40.133Z", mentionCount: 10, brand: "one"},
            { published: "2018-03-03T00:37:40.133Z", mentionCount: 5, brand: "one"},
            { published: "2018-03-04T00:37:40.133Z", mentionCount: 7, brand: "one"},
            { published: "2018-03-05T00:37:40.133Z", mentionCount: 11, brand: "one"},
            { published: "2018-03-02T00:37:40.133Z", mentionCount: 12, brand: "two"},
            { published: "2018-03-03T00:37:40.133Z", mentionCount: 8, brand: "two"},
            { published: "2018-03-04T00:37:40.133Z", mentionCount: 1, brand: "two"}
        ];


        graph = new b3js.chart();

        graph
            .data(data)
            .element(document.getElementById('bar-graph'))
            .x(d => d.mentionCount)
            .y(d => d.published)
            .colour(d => d.brand )
            .geometry(b3js.barChart())
            .scaleY(b3js.scaleTime())
            .yAxisLabel("Brand")
            .xAxisLabel("Mention count")
            .render();

        data = [
            { published: "2018-03-02T00:37:40.133Z", totalSentiment: 101 },
            { published: "2018-03-03T00:37:40.133Z", totalSentiment: 51},
            { published: "2018-03-04T00:37:40.133Z", totalSentiment: -74},
            { published: "2018-03-05T00:37:40.133Z", totalSentiment: -110},
            { published: "2018-03-06T00:37:40.133Z", totalSentiment: 10}
        ];


        graph = new b3js.chart();

        graph
            .data(data)
            .element(document.getElementById('graph-negative'))
            .x(d => d.published)
            .y(d => d.totalSentiment)
            .geometry(b3js.histogram())
            .scaleX(b3js.scaleTime())
            .yAxisLabel("Net Sentiment")
            .render();


        data = [
            { published: "2018-03-02T00:37:40.133Z", mentionCount: 10, brand: "one" },
            { published: "2018-03-03T00:37:40.133Z", mentionCount: 5, brand: "one"},
            { published: "2018-03-04T00:37:40.133Z", mentionCount: 7, brand: "one"},
            { published: "2018-03-05T00:37:40.133Z", mentionCount: 11, brand: "one"},
            { published: "2018-03-02T00:37:40.133Z", mentionCount: 2, brand: "two" },
            { published: "2018-03-03T00:37:40.133Z", mentionCount: 4, brand: "two"},
            { published: "2018-03-04T00:37:40.133Z", mentionCount: 6, brand: "two"},
            { published: "2018-03-05T00:37:40.133Z", mentionCount: 8, brand: "two"}
        ];

        graph = new b3js.chart();

        graph
            .data(data)
            .element(document.getElementById('histogram-comparison'))
            .x(d => d.published)
            .y(d => d.mentionCount)
            .colour( d => d.brand )
            .geometry(b3js.histogram())
            .scaleX(b3js.scaleTime())
            .render();


        data = [
            { published: "2018-03-02T00:37:40.133Z", mentionCount: 10, brand: 1 },
            { published: "2018-03-04T00:37:40.133Z", mentionCount: 7, brand: 1},
            { published: "2018-03-05T00:37:40.133Z", mentionCount: 11, brand: 1},
            { published: "2018-03-02T00:37:40.133Z", mentionCount: 2, brand: 2 },
            { published: "2018-03-03T00:37:40.133Z", mentionCount: 4, brand: 2},
            { published: "2018-03-05T00:37:40.133Z", mentionCount: 8, brand: 2}
        ];


        graph = new b3js.chart();

        graph
            .data(data)
            .element(document.getElementById('histogram-comparison-missing'))
            .x(d => d.published)
            .y(d => d.mentionCount)
            .colour( d => d.brand )
            .geometry(b3js.histogram())
            .scaleX(b3js.scaleTime())
            .render();



        data = [
            { mentionCount: 10, brand: "Brand One" },
            { mentionCount: 2, brand: "Brand Two" },
            { mentionCount: 4, brand: "Brand Three"},
            { mentionCount: 8, brand: "Brand Four"},
            { mentionCount: 5, brand: "Brand Five"},
            { mentionCount: 5, brand: "Brand Five"}

        ];


        graph = new b3js.chart("Histogram Brand Name");

        graph
            .data(data)
            .element(document.getElementById('histogram-brand-name'))
            .x(d => d.brand)
            .y(d => d.mentionCount)
            .geometry(b3js.columnChart())
            .scaleX(b3js.scaleDiscrete())
            .yAxisLabel("Brand Volume")
            .render();

        data = [
            { published: "2018-03-02T00:37:40.133Z", mentionCount: 10, brand: 1 },
            { published: "2018-03-03T00:37:40.133Z", mentionCount: 5, brand: 1},
            { published: "2018-03-04T00:37:40.133Z", mentionCount: 7, brand: 1},
            { published: "2018-03-05T00:37:40.133Z", mentionCount: 11, brand: 1},
            { published: "2018-03-02T00:37:40.133Z", mentionCount: 2, brand: 2 },
            { published: "2018-03-03T00:37:40.133Z", mentionCount: 4, brand: 2},
            { published: "2018-03-04T00:37:40.133Z", mentionCount: 6, brand: 2},
            { published: "2018-03-05T00:37:40.133Z", mentionCount: 8, brand: 2}
        ];


        graph = new b3js.chart("Histogram Facet");

        graph
            .data(data)
            .element(document.getElementById('histogram-facet'))
            .x(d => d.published)
            .y(d => d.mentionCount)
            .geometry(b3js.histogram())
            .scaleX(b3js.scaleTime())
            .facetX(d => d.brand)
            .render();

        graph = new b3js.chart();

        graph
            .data(data)
            .element(document.getElementById('multiple-lines'))
            .x(d => d.published)
            .y(d => d.mentionCount)
            .geometry(b3js.line())
            .scaleX(b3js.scaleTime())
            .colour(d => d.brand)
            .render();

        d3.csv("engagement.csv").then(data => {
            data.forEach(d => d.count = +d.count); // convert to number
            graph = new b3js.chart();
            graph
                .data(data)
                .element(document.getElementById('histogram-real'))
                .x(d => d.count)
                .geometry(b3js.histogram())
                .facetX(d => d.aggregate)
                .render();
        });

        d3.csv("point-data.csv", d => {
            return {
                published: new Date(d.published),
                mentionCount: +d.mentionCount,
                totalSentiment: +d.totalSentiment,
                totalEngagement: +d.totalEngagement
            }
        }).then(data => {
            graph = new b3js.chart();
            graph
                .data(data)
                .element(document.getElementById('sentiment-engagement-points'))
                .x(d => d.totalSentiment)
                .y(d => d.totalEngagement)
                .geometry(b3js.points())
                .facetX(d => d.aggregate)
                .render();
        })

        const pieData = [
            { count: 1930, topicName: 'Reputation' },
            { count: 1030, topicName: 'Charity or outreach programmes' },
            { count: 130,  topicName: 'Banking products' },
            { count: 1234, topicName: 'Customer service' },
            { count: 441,  topicName: 'Bank facilities' },
            { count: 22,   topicName: 'Turnaround time' },
            { count: 568,  topicName: 'Comparing brands to brands' },
            { count: 244,  topicName: 'Outstanding debt or settlements' },
            { count: 902,  topicName: 'Speed or responsiveness of platform' },
            { count: 178,  topicName: 'Personal loans' },
            { count: 351,  topicName: 'Referral or dissuasion from one consumer to another' },
            { count: 800,  topicName: 'Staff or HR' },
            { count: 288,  topicName: 'No response received' },
            { count: 276,  topicName: 'Reaction to brands advertising' },
            { count: 1012, topicName: 'Business banking' },
            { count: 90,   topicName: 'Insurance' },
            { count: 582,  topicName: 'Multiple contacts' }
        ]

        const pieChart = new b3js.chart('Pie');
        const pieGeom = b3js.pie();

        pieChart
            .data(pieData)
            .element(document.getElementById('pie-chart'))
            .x(d => d.topicName)
            .y(d => d.count)
            .geometry(pieGeom.isDonut(true))
            .scaleX(b3js.scaleDiscrete())
            .yAxisLabel('Count')
            .xAxisLabel('Topics')
            .showXAxis(false)
            .showYAxis(false)
            .render()

        const interactions = document.createElement('div');
        const btn = document.createElement('button');
        const donutToggle = document.createElement('button');
        const outsideLabelToggle = document.createElement('button');

        btn.innerHTML = 'Update data';
        donutToggle.innerHTML = 'Toggle donut';
        outsideLabelToggle.innerHTML = 'Toggle outside labels';

        let i = 0;
        const mod = 3;
        btn.addEventListener('click', function(){
            pieData.forEach(item => item.count = (Math.random()*150).toFixed(2));
            i === mod ? i = 0 : i += 1 ;
            pieChart.render();
        })

        donutToggle.addEventListener('click', function(){
          pieGeom.isDonut(!pieGeom.isDonut());
          pieChart.render();
        });

        outsideLabelToggle.addEventListener('click', function(){
          pieGeom.useOutsideLabels(!pieGeom.useOutsideLabels());
          pieChart.render();
        })

        interactions.appendChild(btn);
        interactions.appendChild(donutToggle);
        interactions.appendChild(outsideLabelToggle);

        document.getElementById('pie-chart').parentElement.appendChild(interactions)

    });
</script>


</body>

</html>
